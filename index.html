<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>銀髮族友善問卷（研究版）</title>
  <style>
    :root{
      --bg:#f7f5ef;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#2563eb;
      --danger:#b91c1c;
      --shadow: 0 8px 22px rgba(0,0,0,.08);
      --radius:16px;
      --pad:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Microsoft JhengHei","Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.45;
    }
    .wrap{max-width:860px;margin:0 auto;padding:14px 14px 110px}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:var(--pad);
    }
    h1{font-size:24px;margin:0 0 10px}
    h2{font-size:22px;margin:0 0 10px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .spacer{height:12px}
    .divider{height:1px;background:var(--border);margin:14px 0}

    /* Progress */
    .progressWrap{display:none; gap:10px; align-items:center}
    .progressBar{
      flex:1;
      height:12px;
      background:#eef2ff;
      border-radius:999px;
      overflow:hidden;
      border:1px solid #dbeafe;
    }
    .progressFill{height:100%;width:0%;background:var(--accent)}
    .progressText{font-size:16px; min-width:120px; text-align:right}

    /* Big inputs */
    label{font-size:18px}
    select, input[type="text"]{
      font-size:18px;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid var(--border);
      width:100%;
      max-width:420px;
    }
    .help{font-size:14px;color:var(--muted);margin-top:6px}

    .bigOption{
      width:100%;
      text-align:left;
      font-size:20px;
      padding:14px 14px;
      border-radius:14px;
      border:2px solid var(--border);
      background:#fff;
      cursor:pointer;
      min-height:52px; /* >=44px */
    }
    .bigOption + .bigOption{margin-top:10px}
    .bigOption[aria-pressed="true"]{
      border-color:var(--accent);
      outline:3px solid rgba(37,99,235,.15);
      background:#eff6ff;
    }

    .err{
      display:none;
      color:var(--danger);
      font-size:18px;
      padding:10px 12px;
      border:1px solid #fecaca;
      background:#fff1f2;
      border-radius:12px;
      margin-top:10px;
    }

    /* Bottom nav */
    .bottomNav{
      position:fixed;
      left:0; right:0; bottom:0;
      background:rgba(247,245,239,.96);
      border-top:1px solid var(--border);
      padding:10px 14px;
      display:flex;
      gap:10px;
      justify-content:center;
      z-index:999;
      backdrop-filter: blur(6px);
    }
    .btn{
      font-size:20px;
      padding:14px 18px;
      border-radius:14px;
      border:2px solid var(--border);
      background:#fff;
      cursor:pointer;
      min-height:52px;
      min-width:140px;
    }
    .btnPrimary{background:var(--accent); border-color:var(--accent); color:#fff}
    .btnDanger{background:var(--danger); border-color:var(--danger); color:#fff}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .tag{
      display:inline-block;
      font-size:14px;
      padding:4px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      color:var(--muted);
      background:#fff;
    }
    .pillRow{display:flex;gap:8px;flex-wrap:wrap}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .small{font-size:14px}
    .noticeBox{
      border:1px dashed #c7d2fe;
      background:#eef2ff;
      padding:12px 14px;
      border-radius:14px;
    }
    .center{text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app"></div>
  </div>

  <div class="bottomNav" id="bottomNav" style="display:none;">
    <button class="btn" id="btnBack">上一題</button>
    <button class="btn btnPrimary" id="btnNext">下一題</button>
  </div>

<script>
/** =========================
 * 0) 管理者設定
 * ========================= */
const CONFIG = {
  WEBAPP_URL: "https://script.google.com/macros/s/AKfycbytMnZfbysWU-O1PI81kR-IhhumAvENjQV-mpguAmeFpCDWoncc8r_JmiaTPDu7S56DOQ/exec",
  SECRET: "mys3cret123",
  IDLE_THRESHOLD_SEC: 30,
  DEBUG: false,
};

/** =========================
 * 1) 題庫（Placeholder）
 * ========================= */
const LIKERT5 = [
  { value: 1, label: "非常不同意" },
  { value: 2, label: "不太同意" },
  { value: 3, label: "普通" },
  { value: 4, label: "同意" },
  { value: 5, label: "非常同意" },
];

const QUESTION_BANK = [
  {
    "category_id": 1,
    "category_title": "喚醒傾向量表（APS）",
    "est_minutes": 4,
    "questions": [
      {
        "question_id": "APS_01",
        "instrument": "APS",
        "text": "我是一個非常冷靜的人。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_02",
        "instrument": "APS",
        "text": "我在煩躁不安後需要很長時間才能放鬆",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_03",
        "instrument": "APS",
        "text": "當我興奮時，很難入睡",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_04",
        "instrument": "APS",
        "text": "當我興奮時，我的心跳比大多數人快。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_05",
        "instrument": "APS",
        "text": "夜晚我對噪音非常敏感。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_06",
        "instrument": "APS",
        "text": "我很容易被突如其來的聲音嚇到。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_07",
        "instrument": "APS",
        "text": "我的情緒往往非常強烈",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_08",
        "instrument": "APS",
        "text": "我對強光非常敏感。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_09",
        "instrument": "APS",
        "text": "經歷壓力事件後，我需要很長時間才能平靜下來。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_10",
        "instrument": "APS",
        "text": "我覺得「輕鬆生活」很容易",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_11",
        "instrument": "APS",
        "text": "我的肌肉經常感覺緊張或緊繃。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "APS_12",
        "instrument": "APS",
        "text": "我經常感到「緊張兮兮」或緊繃。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "幾乎從不"
          },
          {
            "value": 2,
            "label": "很少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "常常"
          },
          {
            "value": 5,
            "label": "幾乎總是"
          }
        ],
        "option_type": "LIKERT"
      }
    ]
  },
  {
    "category_id": 2,
    "category_title": "睡前激發程度量表（PSAS）",
    "est_minutes": 5,
    "questions": [
      {
        "question_id": "PSAS_01",
        "instrument": "PSAS",
        "text": "感覺心臟快速、劇烈或不規則地跳動。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_02",
        "instrument": "PSAS",
        "text": "感覺身體緊張不安。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_03",
        "instrument": "PSAS",
        "text": "感覺喘不過氣或呼吸困難。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_04",
        "instrument": "PSAS",
        "text": "感覺肌肉緊繃。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_05",
        "instrument": "PSAS",
        "text": "感覺手、腳或身體冰冷。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_06",
        "instrument": "PSAS",
        "text": "感覺胃不適 (翻攪、糾結、噁心、灼熱、反胃、脹氣等)。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_07",
        "instrument": "PSAS",
        "text": "感覺手掌心或身體其他部位出汗。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_08",
        "instrument": "PSAS",
        "text": "感覺口乾舌躁。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_09",
        "instrument": "PSAS",
        "text": "擔心無法入睡。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_10",
        "instrument": "PSAS",
        "text": "開始回憶或思考一天所發生事情。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_11",
        "instrument": "PSAS",
        "text": "憂鬱或焦慮的想法。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_12",
        "instrument": "PSAS",
        "text": "擔心睡眠以外的問題。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_13",
        "instrument": "PSAS",
        "text": "思想清楚、活躍。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_14",
        "instrument": "PSAS",
        "text": "無法停止思考。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_15",
        "instrument": "PSAS",
        "text": "思想持續盤旋在心裡。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "PSAS_16",
        "instrument": "PSAS",
        "text": "被環境的聲音或噪音所困擾 (時鐘的滴答聲、家人或交通的吵雜聲)。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "完全沒有感覺"
          },
          {
            "value": 2,
            "label": "稍微感覺到"
          },
          {
            "value": 3,
            "label": "中等強度的感覺"
          },
          {
            "value": 4,
            "label": "強烈感覺"
          },
          {
            "value": 5,
            "label": "極端強烈的感覺"
          }
        ],
        "option_type": "LIKERT"
      }
    ]
  },
  {
    "category_id": 3,
    "category_title": "認知情緒調節問卷（CERQ）",
    "est_minutes": 8,
    "questions": [
      {
        "question_id": "CERQ_01",
        "instrument": "CERQ",
        "text": "我認為這件事應該歸咎於我。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_02",
        "instrument": "CERQ",
        "text": "我認為我必須接受已經造成的結果。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_03",
        "instrument": "CERQ",
        "text": "我常常思索自己對所遭遇的狀況有什麼感受。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_04",
        "instrument": "CERQ",
        "text": "我會想著那些比我所遭遇更美好的事情。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_05",
        "instrument": "CERQ",
        "text": "我想著我如何能把事情做到最好。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_06",
        "instrument": "CERQ",
        "text": "我會認為我可以從所遇到的狀況中學到經驗。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_07",
        "instrument": "CERQ",
        "text": "我認為這一切本來可能會更糟。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_08",
        "instrument": "CERQ",
        "text": "我經常覺得我所經歷過的遭遇比其他人都還要糟糕。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_09",
        "instrument": "CERQ",
        "text": "我認為這件事情應該歸咎於他人。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_10",
        "instrument": "CERQ",
        "text": "我認為我應該為所發生的事情負責。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_11",
        "instrument": "CERQ",
        "text": "我認為我必須接受這樣的結果。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_12",
        "instrument": "CERQ",
        "text": "我滿腦子在想發生過的事情以及事情給我的感受。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_13",
        "instrument": "CERQ",
        "text": "即便沒什麼關聯，我也會想起令人愉悅的事情。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_14",
        "instrument": "CERQ",
        "text": "我會思考如何把所遇到的狀況做最好的處理。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_15",
        "instrument": "CERQ",
        "text": "我認為經驗使我成為一個更堅強的人。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_16",
        "instrument": "CERQ",
        "text": "我認為其他人一定經歷過更糟的事情。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_17",
        "instrument": "CERQ",
        "text": "我會不斷的想著我曾經歷過的情況有多糟糕。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_18",
        "instrument": "CERQ",
        "text": "我覺得其他人應該為所發生的事情負責。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_19",
        "instrument": "CERQ",
        "text": "我會想著在這件事情上我所犯的錯誤。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_20",
        "instrument": "CERQ",
        "text": "我認為在這件事上我無法做任何改變。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_21",
        "instrument": "CERQ",
        "text": "我想要知道為什麼當我面對我所遭遇的事情時所產生的感覺。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_22",
        "instrument": "CERQ",
        "text": "無論發生什麼狀況，我都會想些讓我覺得美好的事情。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_23",
        "instrument": "CERQ",
        "text": "我會思考如何改變所遭遇的狀況。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_24",
        "instrument": "CERQ",
        "text": "我認為這樣的狀況一定有好的一面。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_25",
        "instrument": "CERQ",
        "text": "跟其他事情比起來，我認為這件事還不算太糟。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_26",
        "instrument": "CERQ",
        "text": "我常認為我遭遇了世界上最糟糕的情況。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_27",
        "instrument": "CERQ",
        "text": "我會注意別人在這件事情上所犯的錯誤。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_28",
        "instrument": "CERQ",
        "text": "我認為根本的原因在於我自己。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_29",
        "instrument": "CERQ",
        "text": "我認為我必須學著與這樣的狀況共處。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_30",
        "instrument": "CERQ",
        "text": "我常會思索情境所帶給我的感受。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_31",
        "instrument": "CERQ",
        "text": "我會想著過去愉快的經驗。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_32",
        "instrument": "CERQ",
        "text": "我會思考一個我能做到最好的計畫。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_33",
        "instrument": "CERQ",
        "text": "我會尋找事情的光明面。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_34",
        "instrument": "CERQ",
        "text": "我告訴自己，人生還有更糟糕的事情。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_35",
        "instrument": "CERQ",
        "text": "我不斷地回想該情況有多可怕。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "CERQ_36",
        "instrument": "CERQ",
        "text": "我認為事情根本的原因在於他人。",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "從未如此"
          },
          {
            "value": 2,
            "label": "很少如此"
          },
          {
            "value": 3,
            "label": "有時如此"
          },
          {
            "value": 4,
            "label": "經常如此"
          },
          {
            "value": 5,
            "label": "總是如此"
          }
        ],
        "option_type": "LIKERT"
      }
    ]
  },
  {
    "category_id": 4,
    "category_title": "失眠嚴重度量表（ISI）",
    "est_minutes": 3,
    "questions": [
      {
        "question_id": "ISI_01",
        "instrument": "ISI",
        "text": "入睡困難",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "無"
          },
          {
            "value": 2,
            "label": "輕度"
          },
          {
            "value": 3,
            "label": "中度"
          },
          {
            "value": 4,
            "label": "重度"
          },
          {
            "value": 5,
            "label": "非常嚴重"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "ISI_02",
        "instrument": "ISI",
        "text": "無法維持較長的睡眠",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "無"
          },
          {
            "value": 2,
            "label": "輕度"
          },
          {
            "value": 3,
            "label": "中度"
          },
          {
            "value": 4,
            "label": "重度"
          },
          {
            "value": 5,
            "label": "非常嚴重"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "ISI_03",
        "instrument": "ISI",
        "text": "太早醒",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "無"
          },
          {
            "value": 2,
            "label": "輕度"
          },
          {
            "value": 3,
            "label": "中度"
          },
          {
            "value": 4,
            "label": "重度"
          },
          {
            "value": 5,
            "label": "非常嚴重"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "ISI_04",
        "instrument": "ISI",
        "text": "您滿意自己最近的睡眠狀態嗎？",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "無"
          },
          {
            "value": 2,
            "label": "輕度"
          },
          {
            "value": 3,
            "label": "中度"
          },
          {
            "value": 4,
            "label": "重度"
          },
          {
            "value": 5,
            "label": "非常嚴重"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "ISI_05",
        "instrument": "ISI",
        "text": "睡眠問題是否有干擾到您的日常生活功能？(如工作表現/日常瑣事/專注力/記憶力/情緒等)",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "無"
          },
          {
            "value": 2,
            "label": "輕度"
          },
          {
            "value": 3,
            "label": "中度"
          },
          {
            "value": 4,
            "label": "重度"
          },
          {
            "value": 5,
            "label": "非常嚴重"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "ISI_06",
        "instrument": "ISI",
        "text": "他人是否有注意到您的生活品質因睡眠問題受到影響？",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "無"
          },
          {
            "value": 2,
            "label": "輕度"
          },
          {
            "value": 3,
            "label": "中度"
          },
          {
            "value": 4,
            "label": "重度"
          },
          {
            "value": 5,
            "label": "非常嚴重"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "ISI_07",
        "instrument": "ISI",
        "text": "最近的睡眠問題是否令您擔心困擾？",
        "scale_min": 1,
        "scale_max": 5,
        "options": [
          {
            "value": 1,
            "label": "無"
          },
          {
            "value": 2,
            "label": "輕度"
          },
          {
            "value": 3,
            "label": "中度"
          },
          {
            "value": 4,
            "label": "重度"
          },
          {
            "value": 5,
            "label": "非常嚴重"
          }
        ],
        "option_type": "LIKERT"
      }
    ]
  },
  {
    "category_id": 5,
    "category_title": "STOP-BANG 問卷",
    "est_minutes": 3,
    "questions": [
      {
        "question_id": "SB_01",
        "instrument": "STOPBANG",
        "text": "您是否打呼很大聲,聲音大到門關著外面都可以聽到,或枕邊人會因為您打呼而用手肘頂您?",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      },
      {
        "question_id": "SB_02",
        "instrument": "STOPBANG",
        "text": "您是否在白天經常覺得疲勞、疲累或想睡覺,例如開車時會睡著?",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      },
      {
        "question_id": "SB_03",
        "instrument": "STOPBANG",
        "text": "是否有人觀察到您在睡覺時會呼吸停止、嗆到或端氣?",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      },
      {
        "question_id": "SB_04",
        "instrument": "STOPBANG",
        "text": "您是否有高血壓,或已經正在接受高血壓治療?",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      },
      {
        "question_id": "SB_05",
        "instrument": "STOPBANG",
        "text": "您的身體質量指數 (BMI)是否超過35公斤/平方公尺?",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      },
      {
        "question_id": "SB_06",
        "instrument": "STOPBANG",
        "text": "您的年紀是否超過50歲?",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      },
      {
        "question_id": "SB_07",
        "instrument": "STOPBANG",
        "text": "請問您的頸圍尺寸是不是大號的?(從喉結部位測量一圈)",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      },
      {
        "question_id": "SB_08",
        "instrument": "STOPBANG",
        "text": "您的性別是否為男性?",
        "scale_min": 0,
        "scale_max": 1,
        "options": [
          {
            "value": 1,
            "label": "是"
          },
          {
            "value": 0,
            "label": "否"
          }
        ],
        "option_type": "BINARY"
      }
    ]
  },
  {
    "category_id": 6,
    "category_title": "睡眠衛生（SHPS）",
    "est_minutes": 10,
    "questions": [
      {
        "question_id": "SHPS_01",
        "instrument": "SHPS",
        "text": "晚上上床睡覺的時間不規律",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_02",
        "instrument": "SHPS",
        "text": "早上起床的時間不規律",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_03",
        "instrument": "SHPS",
        "text": "早上醒來後會賴床",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_04",
        "instrument": "SHPS",
        "text": "週末補眠",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_05",
        "instrument": "SHPS",
        "text": "在床上做其他與睡眠無關的事（如：看電視、看書，性行為除外）",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_06",
        "instrument": "SHPS",
        "text": "睡前太飢餓",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_07",
        "instrument": "SHPS",
        "text": "睡前擔心自己會睡不著",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_08",
        "instrument": "SHPS",
        "text": "睡前有不愉快的談話",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_09",
        "instrument": "SHPS",
        "text": "睡前沒有足夠的時間讓自己放鬆",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_10",
        "instrument": "SHPS",
        "text": "開著電視或音響入睡",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_11",
        "instrument": "SHPS",
        "text": "躺上床後仍在腦海中思考未解決的問題",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_12",
        "instrument": "SHPS",
        "text": "半夜會起來看時鐘",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_13",
        "instrument": "SHPS",
        "text": "白天小睡或躺在床上休息的時間超過一小時",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_14",
        "instrument": "SHPS",
        "text": "白天缺乏接受太陽光照",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_15",
        "instrument": "SHPS",
        "text": "缺乏規律的運動",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_16",
        "instrument": "SHPS",
        "text": "白天擔心晚上會睡不著",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_17",
        "instrument": "SHPS",
        "text": "睡前四個小時飲用含咖啡因的飲料（如：咖啡、茶、可樂、提神飲料）",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_18",
        "instrument": "SHPS",
        "text": "睡前兩小時喝酒",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_19",
        "instrument": "SHPS",
        "text": "睡前兩小時使用刺激性物質（如：抽煙、嚼檳榔）",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_20",
        "instrument": "SHPS",
        "text": "睡前兩小時做激烈的運動",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_21",
        "instrument": "SHPS",
        "text": "睡前一小時吃太多食物",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_22",
        "instrument": "SHPS",
        "text": "睡前一小時喝太多飲料",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_23",
        "instrument": "SHPS",
        "text": "睡眠環境太吵或太安靜",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_24",
        "instrument": "SHPS",
        "text": "睡眠環境太亮或太暗",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_25",
        "instrument": "SHPS",
        "text": "睡眠環境「溼度」太高或太低",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_26",
        "instrument": "SHPS",
        "text": "睡眠環境「室溫」太高或太低",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_27",
        "instrument": "SHPS",
        "text": "臥室空氣不流通",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_28",
        "instrument": "SHPS",
        "text": "寢具不舒適（如：床太寬或太窄、床墊太軟、枕頭太高或太低、 太軟或太硬等）",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_29",
        "instrument": "SHPS",
        "text": "臥房擺設過多與睡眠無關甚至干擾睡眠的雜物",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      },
      {
        "question_id": "SHPS_30",
        "instrument": "SHPS",
        "text": "被床伴干擾睡眠",
        "scale_min": 1,
        "scale_max": 6,
        "options": [
          {
            "value": 1,
            "label": "從不"
          },
          {
            "value": 2,
            "label": "極少"
          },
          {
            "value": 3,
            "label": "偶爾"
          },
          {
            "value": 4,
            "label": "有時"
          },
          {
            "value": 5,
            "label": "常常"
          },
          {
            "value": 6,
            "label": "總是"
          }
        ],
        "option_type": "LIKERT"
      }
    ]
  },
  {
    "category_id": 7,
    "category_title": "睡眠信念（0–10）",
    "est_minutes": 8,
    "questions": [
      {
        "question_id": "SBEL_01",
        "instrument": "SLEEP_BELIEF",
        "text": "我每天需要八小時的睡眠,白天才會有精神,工作表現才會好。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_02",
        "instrument": "SLEEP_BELIEF",
        "text": "當我前一天睡的不好,隔天一定需要睡午覺補眠,或是晚上早點上床睡覺。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_03",
        "instrument": "SLEEP_BELIEF",
        "text": "我擔心長期失眠可能會造成嚴重的身體健康問題。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_04",
        "instrument": "SLEEP_BELIEF",
        "text": "我擔心自己可能失去控制睡眠的能力。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_05",
        "instrument": "SLEEP_BELIEF",
        "text": "當前一晚睡的不好,我知道隔天的活動一定會受到影響。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_06",
        "instrument": "SLEEP_BELIEF",
        "text": "為了保持白天的清醒與工作表現,我認為比較好的方式是吃助眠藥物,而不是讓自己一整晚睡不好。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_07",
        "instrument": "SLEEP_BELIEF",
        "text": "如果我在白天感到暴躁、憂郁、焦慮,大部分是因為前一晚沒睡好。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_08",
        "instrument": "SLEEP_BELIEF",
        "text": "如果某個晚上我睡的不好,我知道整個星期的睡眠時間就會被打亂。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_09",
        "instrument": "SLEEP_BELIEF",
        "text": "如果晚上沒有適當的睡眠,隔天我簡直沒辦法做事情。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_10",
        "instrument": "SLEEP_BELIEF",
        "text": "我始終沒辦法預測自己晚上的睡眠狀況是好或是不好。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_11",
        "instrument": "SLEEP_BELIEF",
        "text": "我只有一點點的能力可以處理睡眠困擾所產生的負面影響。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_12",
        "instrument": "SLEEP_BELIEF",
        "text": "如果我在白天感到疲累、沒有精力、或是表現不好,通常是因為前一晚睡得不好。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_13",
        "instrument": "SLEEP_BELIEF",
        "text": "我相信失眠是因為體内化學物質不平衡所致。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_14",
        "instrument": "SLEEP_BELIEF",
        "text": "我覺得失眠摧毁自己享受生命的能力,而且讓我不能随心所欲地做想做的事。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_15",
        "instrument": "SLEEP_BELIEF",
        "text": "藥物是解决失眠的唯一方式。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      },
      {
        "question_id": "SBEL_16",
        "instrument": "SLEEP_BELIEF",
        "text": "如果我前一夜無法安眠,我隔天會逃避或取消自己應該做的事(社會的、家庭的)。",
        "scale_min": 0,
        "scale_max": 10,
        "options": [
          {
            "value": 0,
            "label": "0"
          },
          {
            "value": 1,
            "label": "1"
          },
          {
            "value": 2,
            "label": "2"
          },
          {
            "value": 3,
            "label": "3"
          },
          {
            "value": 4,
            "label": "4"
          },
          {
            "value": 5,
            "label": "5"
          },
          {
            "value": 6,
            "label": "6"
          },
          {
            "value": 7,
            "label": "7"
          },
          {
            "value": 8,
            "label": "8"
          },
          {
            "value": 9,
            "label": "9"
          },
          {
            "value": 10,
            "label": "10"
          }
        ],
        "option_type": "SCALE_0_10"
      }
    ]
  }
];

const PRIVACY_NOTICE = {
  A_long: `
    <h2>隱私與資料使用告知（版本 A）</h2>
    <p>本研究將蒐集您在本問卷中的作答資料，以及您在填答過程中的操作行為（例如：每題作答時間、按「上一題/下一題」、停頓時間等）。資料將用於學術研究分析。</p>
    <p>本研究因回訪追蹤需要，會蒐集姓名以核對身分；姓名將與研究分析資料分開保存並限制存取權限。</p>
    <p class="muted">提醒：您可隨時停止填答；停止不會造成任何不利影響。</p>
  `,
  B_usable: `
    <h2>隱私與資料使用告知（版本 B：重點版）</h2>
    <div class="noticeBox">
      <ul>
        <li>我們會收集：<b>姓名（用於回訪核對）</b>、<b>問卷答案</b>與<b>填答過程</b>（例如每題花多久、是否按上一題、停頓多久）。</li>
        <li>用途：只用於<b>學術研究分析</b>。</li>
        <li>姓名會與研究分析資料<b>分開保存</b>並限制存取權限。</li>
        <li>您可以隨時停止填答，不會有任何不利影響。</li>
      </ul>
    </div>
  `
};

const LS = {
  PID: "survey_pid",
  UI: "survey_ui_condition",
  PV: "survey_privacy_version",
  START: "survey_start_ts",
  STEP: "survey_step",
  CUR_INDEX: "survey_cur_index",
  ANSWERS: "survey_answers",
  VIEW_TS: "survey_view_ts_map",
  CHANGES: "survey_changes_map",
  RESUME: "survey_resume_count",
  EVENTQ: "survey_event_queue",
  SESSION_SENT: "survey_session_init_sent",
  CONSENT_TS0: "survey_consent_ts0",
  CONSENT_MAX_SCROLL: "survey_consent_max_scroll",
  BG: "survey_background",
  RESPQ: "survey_response_queue",
  PARTICIPANT_SENT: "survey_participant_sent",
};

const UI_CONDITIONS = ["ONEQ_PROGRESS_ON","ONEQ_PROGRESS_OFF","TWOQ_PROGRESS_ON","TWOQ_PROGRESS_OFF"];

function nowISO(){ return new Date().toISOString(); }
function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
function randomPick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function getDeviceType(){
  const w = window.innerWidth;
  if (w <= 640) return "mobile";
  if (w <= 1024) return "tablet";
  return "desktop";
}
function debug(...args){ if (CONFIG.DEBUG) console.log(...args); }

/** Flatten */
function flattenQuestions(bank){
  const flat = [];
  let idx = 0;
  for (const cat of bank){
    for (const q of cat.questions){
      idx += 1;
      flat.push({ ...q, category_id: cat.category_id, category_title: cat.category_title, est_minutes: cat.est_minutes ?? null, q_index: idx });
    }
  }
  return flat;
}
const FLAT = flattenQuestions(QUESTION_BANK);
const TOTAL_Q = FLAT.length;

function getPaging(ui){ return ui.startsWith("TWOQ") ? 2 : 1; }
function isProgressOn(ui){ return ui.endsWith("ON"); }

/** init identity */
function initIdentityAndConditions(){
  let pid = localStorage.getItem(LS.PID);
  if (!pid){
    pid = crypto.randomUUID();
    localStorage.setItem(LS.PID, pid);
  }
  let ui = localStorage.getItem(LS.UI);
  if (!ui){
    ui = randomPick(UI_CONDITIONS);
    localStorage.setItem(LS.UI, ui);
  }
  let pv = localStorage.getItem(LS.PV);
  if (!pv){
    pv = randomPick(["A_long","B_usable"]);
    localStorage.setItem(LS.PV, pv);
  }
  if (!localStorage.getItem(LS.START)){
    localStorage.setItem(LS.START, nowISO());
  }
  const prev = parseInt(localStorage.getItem(LS.RESUME) || "0", 10);
  localStorage.setItem(LS.RESUME, String(prev + 1));
  return { pid, ui, pv };
}

/** events + idle */
let idleTimer = null, inIdle = false, lastInteractionTs = Date.now();

function getCurrentQIndex(){ return parseInt(localStorage.getItem(LS.CUR_INDEX) || "0", 10); }
function setCurrentQIndex(i){ localStorage.setItem(LS.CUR_INDEX, String(clamp(i,0,Math.max(0,TOTAL_Q-1)))); }

function getCurrentPageNo(){
  const ui = localStorage.getItem(LS.UI) || "ONEQ_PROGRESS_ON";
  const paging = getPaging(ui);
  const idx = getCurrentQIndex();
  return Math.floor(idx / paging) + 1;
}

function pushEvent(event_type, payload={}){
  const pid = localStorage.getItem(LS.PID);
  const q = FLAT[getCurrentQIndex()] || null;
  const evt = {
    participant_id: pid,
    ts: nowISO(),
    event_type,
    category_id: q ? q.category_id : null,
    question_id: q ? q.question_id : null,
    q_index: q ? q.q_index : null,
    page_no: getCurrentPageNo(),
    meta_json: JSON.stringify(payload || {})
  };
  const queue = JSON.parse(localStorage.getItem(LS.EVENTQ) || "[]");
  queue.push(evt);
  localStorage.setItem(LS.EVENTQ, JSON.stringify(queue));
}

function markInteraction(){
  lastInteractionTs = Date.now();
  if (inIdle){
    inIdle = false;
    pushEvent("idle_end", {});
  }
  scheduleIdleCheck();
}
function scheduleIdleCheck(){
  if (idleTimer) clearTimeout(idleTimer);
  idleTimer = setTimeout(()=>{
    const diffSec = (Date.now() - lastInteractionTs)/1000;
    if (!inIdle && diffSec >= CONFIG.IDLE_THRESHOLD_SEC){
      inIdle = true;
      pushEvent("idle_start", { threshold_sec: CONFIG.IDLE_THRESHOLD_SEC });
    }
    scheduleIdleCheck();
  }, 1000);
}
["click","touchstart","keydown","scroll"].forEach(ev=>{
  window.addEventListener(ev, ()=>markInteraction(), { passive:true });
});

/** Answers */
function getAnswers(){ return JSON.parse(localStorage.getItem(LS.ANSWERS) || "{}"); }
function getViewTsMap(){ return JSON.parse(localStorage.getItem(LS.VIEW_TS) || "{}"); }
function setViewed(question_id){
  const map = getViewTsMap();
  if (!map[question_id]){
    map[question_id] = nowISO();
    localStorage.setItem(LS.VIEW_TS, JSON.stringify(map));
  }
}
function setAnswer(question_id, value){
  const answers = getAnswers();
  const prev = answers[question_id];
  answers[question_id] = value;
  localStorage.setItem(LS.ANSWERS, JSON.stringify(answers));

  const changes = JSON.parse(localStorage.getItem(LS.CHANGES) || "{}");
  if (!changes[question_id]) changes[question_id] = { num_changes: 0, changed_answer: 0 };
  if (prev !== undefined && prev !== value){
    changes[question_id].num_changes += 1;
    changes[question_id].changed_answer = 1;
  }
  localStorage.setItem(LS.CHANGES, JSON.stringify(changes));
  pushEvent("answer_select", { question_id, value });
  enqueueResponseRow(question_id, value);
}

/** Responses queue */
function enqueueResponseRow(question_id, answer_value){
  const pid = localStorage.getItem(LS.PID);
  const ui = localStorage.getItem(LS.UI);
  const pv = localStorage.getItem(LS.PV);
  const q = FLAT.find(x=>x.question_id===question_id);
  if (!q) return;

  const viewMap = getViewTsMap();
  const view_ts = viewMap[question_id] || nowISO();
  const answer_ts = nowISO();
  const time_to_answer_ms = Math.max(0, Date.parse(answer_ts) - Date.parse(view_ts));

  const changes = JSON.parse(localStorage.getItem(LS.CHANGES) || "{}");
  const ch = changes[question_id] || { num_changes: 0, changed_answer: 0 };

  const row = {
    participant_id: pid,
    ui_condition_id: ui,
    privacy_notice_version: pv,
    instrument: q.instrument || null,
    category_id: q.category_id,
    question_id: q.question_id,
    q_index: q.q_index,
    page_no: getCurrentPageNo(),
    answer_value: Number(answer_value),
    scale_min: q.scale_min ?? null,
    scale_max: q.scale_max ?? null,
    option_type: q.option_type || "LIKERT",
    view_ts,
    answer_ts,
    time_to_answer_ms,
    changed_answer: ch.changed_answer,
    num_changes: ch.num_changes,
    created_ts: nowISO(),
  };

  const queue = JSON.parse(localStorage.getItem(LS.RESPQ) || "[]");
  const idx = queue.findIndex(r => r.participant_id===pid && r.question_id===question_id);
  if (idx >= 0) queue[idx] = row; else queue.push(row);
  localStorage.setItem(LS.RESPQ, JSON.stringify(queue));
}

/** GAS post */
async function postToGAS(payload){
  if (!CONFIG.WEBAPP_URL || CONFIG.WEBAPP_URL.includes("PASTE_YOUR")){
    return { ok:false, error:"WEBAPP_URL not set" };
  }
  payload.secret = CONFIG.SECRET;
  try{
    const res = await fetch(CONFIG.WEBAPP_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload),
    });
    const json = await res.json().catch(()=>({ ok:false, error:"Invalid JSON response" }));
    return json;
  }catch(e){
    return { ok:false, error:String(e) };
  }
}

async function flushQueues(){
  const pid = localStorage.getItem(LS.PID);
  const events = JSON.parse(localStorage.getItem(LS.EVENTQ) || "[]");
  const responses = JSON.parse(localStorage.getItem(LS.RESPQ) || "[]");
  if (events.length===0 && responses.length===0) return;
  const r = await postToGAS({ type:"batch", participant_id: pid, events, responses });
  if (r && r.ok){
    localStorage.setItem(LS.EVENTQ, "[]");
    localStorage.setItem(LS.RESPQ, "[]");
  }
}
setInterval(()=>flushQueues(), 10000);

/** steps */
const STEPS = { LANDING:"LANDING", CONSENT:"CONSENT", BACKGROUND:"BACKGROUND", SURVEY:"SURVEY", UX:"UX", DONE:"DONE", DECLINED:"DECLINED" };
function getStep(){ return localStorage.getItem(LS.STEP) || STEPS.LANDING; }
function setStep(step){ localStorage.setItem(LS.STEP, step); }

/** participant row (participants table) */
async function sendParticipantIfNeeded(name){
  if (localStorage.getItem(LS.PARTICIPANT_SENT)==="1") return;
  const pid = localStorage.getItem(LS.PID);
  const payload = {
    type:"participant_upsert",
    participant_id: pid,
    participant: {
      participant_id: pid,
      name: name,
      created_ts: nowISO(),
      contact: null,
      note: null,
    }
  };
  const r = await postToGAS(payload);
  if (r && r.ok) localStorage.setItem(LS.PARTICIPANT_SENT, "1");
}

/** session init */
async function sessionInitIfNeeded(){
  if (localStorage.getItem(LS.SESSION_SENT)==="1") return;
  const pid = localStorage.getItem(LS.PID);
  const ui = localStorage.getItem(LS.UI);
  const pv = localStorage.getItem(LS.PV);
  const start_ts = localStorage.getItem(LS.START);
  const resume_count = parseInt(localStorage.getItem(LS.RESUME) || "1", 10);

  const payload = {
    type:"session_init",
    participant_id: pid,
    session: {
      participant_id: pid,
      start_ts,
      end_ts: null,
      total_duration_sec: null,
      completed: 0,
      dropout_q_index: null,
      dropout_category_id: null,
      resume_count,
      ui_condition_id: ui,
      factor_paging: ui.startsWith("TWOQ") ? "TWOQ" : "ONEQ",
      factor_progress: ui.endsWith("ON") ? "ON" : "OFF",
      privacy_notice_version: pv,
      consent_given: null,
      consent_dwell_time_sec: null,
      consent_scroll_pct: null,
      comprehension_score: null,
      trust_score: null,
      name: null,     // will be filled at background final
      sex: null,
      age_group: null,
      device_type: getDeviceType(),
      screen_width: window.innerWidth,
      screen_height: window.innerHeight,
      ux1: null, ux2: null, ux3: null, ux4: null, ux5: null,
      created_ts: nowISO(),
      updated_ts: nowISO(),
    }
  };
  const r = await postToGAS(payload);
  if (r && r.ok) localStorage.setItem(LS.SESSION_SENT, "1");
}

/** consent */
function calcConsentDwellSec(){
  const t0 = parseInt(localStorage.getItem(LS.CONSENT_TS0) || String(Date.now()), 10);
  return Math.max(0, Math.round((Date.now() - t0)/1000));
}
function updateConsentScrollPct(){
  const maxScroll = parseFloat(localStorage.getItem(LS.CONSENT_MAX_SCROLL) || "0");
  const doc = document.documentElement;
  const scrollTop = doc.scrollTop || document.body.scrollTop;
  const scrollHeight = doc.scrollHeight - doc.clientHeight;
  const pct = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 100;
  localStorage.setItem(LS.CONSENT_MAX_SCROLL, String(Math.max(maxScroll, pct)));
}
window.addEventListener("scroll", ()=>{
  if (getStep()===STEPS.CONSENT) updateConsentScrollPct();
}, { passive:true });

/** UI render */
const app = document.getElementById("app");
const bottomNav = document.getElementById("bottomNav");
const btnBack = document.getElementById("btnBack");
const btnNext = document.getElementById("btnNext");

btnBack.addEventListener("click", ()=>{ pushEvent("back_click", {}); goPrev(); });
btnNext.addEventListener("click", ()=>{ pushEvent("next_click", {}); goNext(); });

function render(){
  const step = getStep();
  if (step === STEPS.LANDING) return renderLanding();
  if (step === STEPS.CONSENT) return renderConsent();
  if (step === STEPS.BACKGROUND) return renderBackground();
  if (step === STEPS.SURVEY) return renderSurvey();
  if (step === STEPS.UX) return renderUX();
  if (step === STEPS.DONE) return renderDone();
  if (step === STEPS.DECLINED) return renderDeclined();
}

function renderLanding(){
  bottomNav.style.display = "none";
  const { pid, ui, pv } = initIdentityAndConditions();
  scheduleIdleCheck();

  app.innerHTML = `
    <h1>問卷填答</h1>
    <p class="muted">本問卷適用銀髮族填答。您可隨時停止，不會造成任何不利影響。</p>
    <div class="pillRow">
      <span class="tag">裝置：${getDeviceType()}</span>
      <span class="tag">研究版</span>
    </div>
    <div class="divider"></div>
    <p>開始前會先顯示「隱私與資料使用告知」。</p>
    <button class="btn btnPrimary" id="startBtn">開始填答</button>
    <div class="spacer"></div>
    <details class="small">
      <summary>（管理者資訊/除錯用）</summary>
      <div class="mono small muted">
        participant_id: ${pid}<br/>
        ui_condition_id: ${ui}<br/>
        privacy_notice_version: ${pv}<br/>
        total_questions: ${TOTAL_Q}
      </div>
    </details>
  `;
  document.getElementById("startBtn").onclick = async ()=>{
    setStep(STEPS.CONSENT);
    localStorage.setItem(LS.CONSENT_TS0, String(Date.now()));
    localStorage.setItem(LS.CONSENT_MAX_SCROLL, "0");
    pushEvent("page_view", { page:"consent" });
    await sessionInitIfNeeded();
    render();
  };
}

function renderConsent(){
  bottomNav.style.display = "none";
  const pv = localStorage.getItem(LS.PV) || "B_usable";

  app.innerHTML = `
    ${PRIVACY_NOTICE[pv]}
    <div class="divider"></div>

    <h2>簡短確認（理解檢核）</h2>
    <p class="muted">請選擇最符合您的答案（1–2 題）。</p>

    <div class="spacer"></div>
    <div>
      <div style="font-size:20px;margin-bottom:8px;">(C1) 本網站會收集「問卷答案」與「填答過程（例如每題花多久）」嗎？</div>
      <div id="c1"></div>
    </div>

    <div class="spacer"></div>
    <div>
      <div style="font-size:20px;margin-bottom:8px;">(C2) 我信任這個網站會妥善處理我的資料。</div>
      <div id="trust"></div>
    </div>

    <div class="err" id="consentErr">請先完成上面的兩題，才能繼續。</div>

    <div class="divider"></div>
    <div class="row">
      <button class="btn btnDanger" id="declineBtn">我不同意</button>
      <button class="btn btnPrimary" id="agreeBtn">我同意</button>
    </div>
  `;

  renderBinaryOptions("c1", "consent_c1", [{ value:1, label:"是" },{ value:0, label:"否" }]);
  renderLikertOptions("trust", "trust_score_tmp", LIKERT5);

  document.getElementById("declineBtn").onclick = async ()=>{
    const dwellSec = calcConsentDwellSec();
    const scrollPct = parseFloat(localStorage.getItem(LS.CONSENT_MAX_SCROLL)||"0");
    pushEvent("submit", { consent_given: 0 });

    await postToGAS({
      type:"consent",
      participant_id: localStorage.getItem(LS.PID),
      consent: {
        consent_given: 0,
        consent_dwell_time_sec: dwellSec,
        consent_scroll_pct: scrollPct,
        comprehension_score: null,
        trust_score: null,
      }
    });
    setStep(STEPS.DECLINED);
    render();
  };

  document.getElementById("agreeBtn").onclick = async ()=>{
    const c1 = getLocalTemp("consent_c1");
    const trust = getAnswers()["trust_score_tmp"];
    if (c1 === null || trust === null){ showErr("consentErr"); return; }
    hideErr("consentErr");

    const comprehension_score = (Number(c1) === 1) ? 1 : 0;
    const dwellSec = calcConsentDwellSec();
    const scrollPct = parseFloat(localStorage.getItem(LS.CONSENT_MAX_SCROLL)||"0");

    // store into BG
    const bg = JSON.parse(localStorage.getItem(LS.BG) || "{}");
    bg.comprehension_score = comprehension_score;
    bg.trust_score = Number(trust);
    localStorage.setItem(LS.BG, JSON.stringify(bg));

    pushEvent("submit", { consent_given: 1, comprehension_score, trust_score:Number(trust) });

    await postToGAS({
      type:"consent",
      participant_id: localStorage.getItem(LS.PID),
      consent: {
        consent_given: 1,
        consent_dwell_time_sec: dwellSec,
        consent_scroll_pct: scrollPct,
        comprehension_score,
        trust_score: Number(trust),
      }
    });

    setStep(STEPS.BACKGROUND);
    render();
  };
}

/** Background: name REQUIRED as first field */
function renderBackground(){
  bottomNav.style.display = "none";
  const bg = JSON.parse(localStorage.getItem(LS.BG) || "{}");
  const name = bg.name ?? "";
  const age = bg.age_group ?? "";
  const sex = bg.sex ?? "";

  app.innerHTML = `
    <h2>基本資料</h2>
    <p class="muted">（必填）請填寫以下資料。</p>

    <div class="spacer"></div>
    <div>
      <label>姓名（必填）</label><br/>
      <input id="name" type="text" inputmode="text" autocomplete="name" placeholder="請輸入姓名" />
      <div class="help">用途：核對身分／回訪追蹤。姓名將分開保存並限制存取。</div>
    </div>

    <div class="spacer"></div>
    <div>
      <label>性別（必填）</label><br/>
      <select id="sex">
        <option value="">請選擇</option>
        <option value="male">男</option>
        <option value="female">女</option>
        <option value="other">其他/不方便回答</option>
      </select>
    </div>

    <div class="spacer"></div>
    <div>
      <label>年齡區間（必填）</label><br/>
      <select id="age">
        <option value="">請選擇</option>
        <option value="60-64">60–64</option>
        <option value="65-69">65–69</option>
        <option value="70-74">70–74</option>
        <option value="75+">75 以上</option>
      </select>
    </div>

    <div class="spacer"></div>
    <div class="noticeBox">
      <div class="muted">裝置資訊（系統自動）：${getDeviceType()} / ${window.innerWidth}×${window.innerHeight}</div>
    </div>

    <div class="err" id="bgErr">請完成必填欄位，才能繼續。</div>

    <div class="divider"></div>
    <button class="btn btnPrimary" id="bgNext">開始填問卷</button>
  `;

  const nameEl = document.getElementById("name");
  const sexEl = document.getElementById("sex");
  const ageEl = document.getElementById("age");
  nameEl.value = name;
  sexEl.value = sex;
  ageEl.value = age;

  document.getElementById("bgNext").onclick = async ()=>{
    const n = (nameEl.value || "").trim();
    if (!n || !sexEl.value || !ageEl.value){ showErr("bgErr"); return; }
    hideErr("bgErr");

    const bg2 = JSON.parse(localStorage.getItem(LS.BG) || "{}");
    bg2.name = n;
    bg2.sex = sexEl.value;
    bg2.age_group = ageEl.value;
    localStorage.setItem(LS.BG, JSON.stringify(bg2));

    // write participants row ASAP
    await sendParticipantIfNeeded(n);

    // init cursor
    if (!localStorage.getItem(LS.CUR_INDEX)) setCurrentQIndex(0);

    setStep(STEPS.SURVEY);
    pushEvent("page_view", { page:"survey" });
    render();
  };
}

function renderSurvey(){
  bottomNav.style.display = "flex";

  const ui = localStorage.getItem(LS.UI) || "ONEQ_PROGRESS_ON";
  const pv = localStorage.getItem(LS.PV) || "B_usable";
  const paging = getPaging(ui);
  const idx = getCurrentQIndex();
  const pageStart = Math.floor(idx / paging) * paging;
  const pageEnd = Math.min(pageStart + paging, TOTAL_Q);
  const pageQs = FLAT.slice(pageStart, pageEnd);
  pageQs.forEach(q => setViewed(q.question_id));

  const showProg = isProgressOn(ui);
  const currentQNumber = pageStart + 1;
  const pct = TOTAL_Q > 0 ? Math.round((currentQNumber / TOTAL_Q) * 100) : 0;

  const catTitle = pageQs[0]?.category_title || "";
  const catId = pageQs[0]?.category_id || null;

  const answers = getAnswers();

  app.innerHTML = `
    <div class="row" style="align-items:center;justify-content:space-between">
      <div class="pillRow">
        <span class="tag">介面條件：<span class="mono">${ui}</span></span>
        <span class="tag">隱私版本：<span class="mono">${pv}</span></span>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="progressWrap" id="progWrap" style="display:${showProg ? "flex":"none"}">
      <div class="progressBar"><div class="progressFill" id="progFill"></div></div>
      <div class="progressText" id="progText"></div>
    </div>

    <div class="spacer"></div>
    <h2>${catTitle}</h2>
    <div class="muted">第 ${pageStart+1} – ${pageEnd} 題 / 共 ${TOTAL_Q} 題</div>

    <div class="divider"></div>
    <div id="questionArea"></div>
    <div class="err" id="qErr">請先選擇每一題的答案才能繼續。</div>
  `;

  if (showProg){
    document.getElementById("progFill").style.width = pct + "%";
    document.getElementById("progText").textContent = `第 ${currentQNumber}/${TOTAL_Q}（${pct}%）`;
  }

  const qa = document.getElementById("questionArea");
  qa.innerHTML = "";
  pageQs.forEach(q=>{
    const selected = answers[q.question_id];
    const block = document.createElement("div");
    block.style.marginBottom = "14px";
    block.innerHTML = `
      <div style="font-size:20px;margin:0 0 10px;">(${q.q_index}) ${escapeHtml(q.text)}</div>
      <div id="opt_${q.question_id}"></div>
    `;
    qa.appendChild(block);
    renderLikertOptions(`opt_${q.question_id}`, q.question_id, q.options, selected);
  });

  btnBack.disabled = (pageStart === 0);
  btnNext.textContent = (pageEnd >= TOTAL_Q) ? "完成並進入下一步" : "下一題";

  pushEvent("page_view", { page:"survey", category_id: catId, page_no: getCurrentPageNo() });

  window.__validatePageAnswered = ()=>{
    for (const q of pageQs){
      const a = getAnswers()[q.question_id];
      if (a === undefined || a === null || a === "") return false;
    }
    return true;
  };
}

function goPrev(){
  const ui = localStorage.getItem(LS.UI) || "ONEQ_PROGRESS_ON";
  const paging = getPaging(ui);
  const idx = getCurrentQIndex();
  const pageStart = Math.floor(idx / paging) * paging;
  const prevPageStart = Math.max(0, pageStart - paging);
  setCurrentQIndex(prevPageStart);
  hideErr("qErr");
  render();
}
function goNext(){
  const ui = localStorage.getItem(LS.UI) || "ONEQ_PROGRESS_ON";
  const paging = getPaging(ui);
  const idx = getCurrentQIndex();
  const pageStart = Math.floor(idx / paging) * paging;
  const pageEnd = Math.min(pageStart + paging, TOTAL_Q);

  if (typeof window.__validatePageAnswered === "function"){
    if (!window.__validatePageAnswered()){ showErr("qErr"); return; }
  }
  hideErr("qErr");

  if (pageEnd >= TOTAL_Q){
    setStep(STEPS.UX);
    bottomNav.style.display = "none";
    render();
    return;
  }
  setCurrentQIndex(pageEnd);
  render();
}

/** Likert/Binary helpers */
function renderLikertOptions(containerId, question_id, options, presetValue=null){
  const el = document.getElementById(containerId);
  if (!el) return;
  const selected = (presetValue !== null && presetValue !== undefined) ? Number(presetValue) : Number(getAnswers()[question_id]);

  el.innerHTML = "";
  options.forEach(opt=>{
    const btn = document.createElement("button");
    btn.className = "bigOption";
    btn.type = "button";
    btn.setAttribute("aria-pressed", String(selected === Number(opt.value)));
    btn.textContent = `${opt.label}`;
    btn.onclick = ()=>{
      [...el.querySelectorAll("button")].forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      setAnswer(question_id, Number(opt.value));
      hideErr("qErr");
    };
    el.appendChild(btn);
  });
}
function renderBinaryOptions(containerId, key, options){
  const el = document.getElementById(containerId);
  const selected = getLocalTemp(key);
  el.innerHTML = "";
  options.forEach(opt=>{
    const btn = document.createElement("button");
    btn.className = "bigOption";
    btn.type = "button";
    btn.setAttribute("aria-pressed", String(selected !== null && Number(selected)===Number(opt.value)));
    btn.textContent = opt.label;
    btn.onclick = ()=>{
      [...el.querySelectorAll("button")].forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      setLocalTemp(key, Number(opt.value));
    };
    el.appendChild(btn);
  });
}
function setLocalTemp(key, value){
  const tmp = JSON.parse(localStorage.getItem("survey_tmp") || "{}");
  tmp[key] = value;
  localStorage.setItem("survey_tmp", JSON.stringify(tmp));
}
function getLocalTemp(key){
  const tmp = JSON.parse(localStorage.getItem("survey_tmp") || "{}");
  return (tmp[key] === undefined) ? null : tmp[key];
}

/** UX page */
function renderUX(){
  bottomNav.style.display = "none";

  app.innerHTML = `
    <h2>最後幾題（使用感受）</h2>
    <p class="muted">請依您的感受作答（1–5）。</p>
    <div class="divider"></div>

    <div id="uxArea"></div>
    <div class="err" id="uxErr">請完成所有題目才能送出。</div>

    <div class="divider"></div>
    <button class="btn btnPrimary" id="submitBtn">送出</button>
  `;

  const UX_QS = [
    { id:"ux1", text:"(UX1) 我覺得這個問卷很容易操作。" },
    { id:"ux2", text:"(UX2) 題目與選項很清楚、容易理解。" },
    { id:"ux3", text:"(UX3) 我覺得填答的負擔不大。" },
    { id:"ux4", text:"(UX4) 填答過程讓我感到安心（不太焦慮）。" },
    { id:"ux5", text:"(UX5) 我覺得填答過程不會太疲勞。" },
  ];

  const area = document.getElementById("uxArea");
  UX_QS.forEach(q=>{
    const block = document.createElement("div");
    block.style.marginBottom="14px";
    block.innerHTML = `
      <div style="font-size:20px;margin:0 0 10px;">${escapeHtml(q.text)}</div>
      <div id="${q.id}"></div>
    `;
    area.appendChild(block);
    renderLikertOptions(q.id, q.id, LIKERT5);
  });

  document.getElementById("submitBtn").onclick = async ()=>{
    const answers = getAnswers();
    for (const q of UX_QS){
      if (answers[q.id] === undefined) { showErr("uxErr"); return; }
    }
    hideErr("uxErr");
    await finalizeAndSubmit();
  };
}

/** Final submit: sends session_final and flush queues */
async function finalizeAndSubmit(){
  const pid = localStorage.getItem(LS.PID);
  const ui = localStorage.getItem(LS.UI);
  const pv = localStorage.getItem(LS.PV);
  const start_ts = localStorage.getItem(LS.START);
  const end_ts = nowISO();
  const total_duration_sec = Math.max(0, Math.round((Date.parse(end_ts) - Date.parse(start_ts))/1000));
  const resume_count = parseInt(localStorage.getItem(LS.RESUME) || "1", 10);

  const bg = JSON.parse(localStorage.getItem(LS.BG) || "{}");
  const name = bg.name ?? null;
  const age_group = bg.age_group ?? null;
  const sex = bg.sex ?? null;
  const comprehension_score = bg.comprehension_score ?? null;
  const trust_score = bg.trust_score ?? null;

  const consent_dwell_time_sec = calcConsentDwellSec();
  const consent_scroll_pct = parseFloat(localStorage.getItem(LS.CONSENT_MAX_SCROLL)||"0");

  const answers = getAnswers();

  pushEvent("submit", { completed: 1 });
  await flushQueues();

  const sessionRow = {
    participant_id: pid,
    start_ts,
    end_ts,
    total_duration_sec,
    completed: 1,
    dropout_q_index: null,
    dropout_category_id: null,
    resume_count,
    ui_condition_id: ui,
    factor_paging: ui.startsWith("TWOQ") ? "TWOQ" : "ONEQ",
    factor_progress: ui.endsWith("ON") ? "ON" : "OFF",
    privacy_notice_version: pv,

    consent_given: 1,
    consent_dwell_time_sec,
    consent_scroll_pct,
    comprehension_score,
    trust_score,

    name,      // stored here too for convenience; primary PII is participants table
    sex,
    age_group,
    device_type: getDeviceType(),
    screen_width: window.innerWidth,
    screen_height: window.innerHeight,

    ux1: answers["ux1"] ?? null,
    ux2: answers["ux2"] ?? null,
    ux3: answers["ux3"] ?? null,
    ux4: answers["ux4"] ?? null,
    ux5: answers["ux5"] ?? null,
    created_ts: nowISO(),
    updated_ts: nowISO(),
  };

  const r = await postToGAS({ type:"session_final", participant_id: pid, session: sessionRow });
  if (r && r.ok){
    // Keep identity/conditions for debugging; clear progress queues
    const keep = [LS.PID, LS.UI, LS.PV];
    const snap = {};
    keep.forEach(k=> snap[k] = localStorage.getItem(k));
    localStorage.clear();
    keep.forEach(k=> { if (snap[k] !== null) localStorage.setItem(k, snap[k]); });
  }
  setStep(STEPS.DONE);
  render();
}

function renderDone(){
  bottomNav.style.display = "none";
  const pid = localStorage.getItem(LS.PID);
  app.innerHTML = `
    <h2 class="center">完成！謝謝您</h2>
    <p class="center muted">您的填答已送出。</p>
	<button
 	 class="primary"
 	 style="margin-top:24px;font-size:18px;padding:14px 22px;"
 	 onclick="handleRestartSurvey()"
	>
  	🔁 重新開始（填寫下一份問卷）
	</button>

    <div class="divider"></div>
    <div class="noticeBox">
      <div>（研究用）參與編號：</div>
      <div class="mono">${pid}</div>
    </div>
  `;
}

function renderDeclined(){
  bottomNav.style.display = "none";
  app.innerHTML = `
    <h2>已結束</h2>
    <p class="muted">您選擇不同意參與，因此不會收集後續資料。謝謝您。</p>
    <button class="btn" id="homeBtn">回首頁</button>
  `;
  document.getElementById("homeBtn").onclick = ()=>{ setStep(STEPS.LANDING); render(); };
}

/** util */
function showErr(id){ const el = document.getElementById(id); if (el) el.style.display = "block"; }
function hideErr(id){ const el = document.getElementById(id); if (el) el.style.display = "none"; }
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
}

/** boot */
(function boot(){
  initIdentityAndConditions();
  render();
})();
// ===== Restart survey helpers =====
function resetSurveyState() {
  const keysToRemove = [];
  for (let i = 0; i < localStorage.length; i++) {
    const k = localStorage.key(i);
    if (k && k.startsWith("survey_")) {
      keysToRemove.push(k);
    }
  }
  keysToRemove.forEach(k => localStorage.removeItem(k));
}

function handleRestartSurvey() {
  if (!confirm("確定要開始填寫下一份問卷嗎？\n目前資料已送出，不會遺失。")) {
    return;
  }
  resetSurveyState();
  location.reload();
}

</script>
</body>
</html>


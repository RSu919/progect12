<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ç¡çœ å•å·ï¼ˆAPS / PSASï¼‰</title>

<style>
  body {
    font-size: 20px;
    max-width: 800px;
    margin: auto;
    line-height: 1.8;
  }
  @media (max-width: 900px) { body { font-size: 21px; } }
  @media (max-width: 600px) { body { font-size: 22px; } }

  .question { margin-bottom: 25px; }
  button {
    font-size: 18px;
    padding: 4px 10px;
    margin-left: 6px;
  }
  .option label {
    display: block;
    margin-left: 20px;
  }
</style>
</head>

<body>

<h1>ç¡çœ å•å·</h1>

<h2>[0] åŸºæœ¬è³‡æ–™</h2>

<div class="question">
  å§“åï¼ˆå¿…å¡«ï¼‰<br>
  <input type="text" id="name">
</div>

<div class="question">
  æ€§åˆ¥ï¼ˆå¿…å¡«ï¼‰<br>
  <label><input type="radio" name="gender" value="ç”·"> ç”·</label>
  <label><input type="radio" name="gender" value="å¥³"> å¥³</label>
</div>

<div class="question">
  å¹´é½¡ï¼ˆå¿…å¡«ï¼‰<br>
  <input type="number" id="age">
</div>

<hr>

<h2>[1] å–šé†’å‚¾å‘é‡è¡¨ï¼ˆAPSï¼‰</h2>
<div id="aps-container"></div>

<hr>

<h2>[2] ç¡å‰æ¿€ç™¼ç¨‹åº¦é‡è¡¨ï¼ˆPSASï¼‰</h2>
<div id="psas-container"></div>

<br>
<button onclick="submitForm()">é€å‡º</button>

<script>
/* ===============================
   å…¨åŸŸè¡Œç‚º log
================================ */
const surveyStartTime = Date.now();
let ttsCount = 0;
let ttsLog = [];

/* å–®é¡Œåæ‡‰æ™‚é–“ï¼ˆç¬¬ä¸€æ¬¡ï¼‰ */
const apsFirstResponseTime = {};
const psasFirstResponseTime = {};

/* ===============================
   APS é¡Œç›®
================================ */
const apsQuestions = [
  "æˆ‘æ˜¯ä¸€å€‹éå¸¸å†·éœçš„äººã€‚",
  "æˆ‘åœ¨ç…©èºä¸å®‰å¾Œéœ€è¦å¾ˆé•·æ™‚é–“æ‰èƒ½æ”¾é¬†ã€‚",
  "ç•¶æˆ‘èˆˆå¥®æ™‚ï¼Œå¾ˆé›£å…¥ç¡ã€‚",
  "ç•¶æˆ‘èˆˆå¥®æ™‚ï¼Œæˆ‘çš„å¿ƒè·³æ¯”å¤§å¤šæ•¸äººå¿«ã€‚",
  "å¤œæ™šæˆ‘å°å™ªéŸ³éå¸¸æ•æ„Ÿã€‚",
  "æˆ‘å¾ˆå®¹æ˜“è¢«çªå¦‚å…¶ä¾†çš„è²éŸ³åš‡åˆ°ã€‚",
  "æˆ‘çš„æƒ…ç·’å¾€å¾€éå¸¸å¼·çƒˆã€‚",
  "æˆ‘å°å¼·å…‰éå¸¸æ•æ„Ÿã€‚",
  "ç¶“æ­·å£“åŠ›äº‹ä»¶å¾Œï¼Œæˆ‘éœ€è¦å¾ˆé•·æ™‚é–“æ‰èƒ½å¹³éœä¸‹ä¾†ã€‚",
  "æˆ‘è¦ºå¾—ã€Œè¼•é¬†ç”Ÿæ´»ã€å¾ˆå®¹æ˜“ã€‚",
  "æˆ‘çš„è‚Œè‚‰ç¶“å¸¸æ„Ÿè¦ºç·Šå¼µæˆ–ç·Šç¹ƒã€‚",
  "æˆ‘ç¶“å¸¸æ„Ÿåˆ°ã€Œç·Šå¼µå…®å…®ã€æˆ–ç·Šç¹ƒã€‚"
];

const apsOptions = ["å¹¾ä¹å¾ä¸","å¾ˆå°‘","å¶çˆ¾","å¸¸å¸¸","å¹¾ä¹ç¸½æ˜¯"];

/* ===============================
   PSAS é¡Œç›®
================================ */
const psasQuestions = [
  "æ„Ÿè¦ºå¿ƒè‡Ÿå¿«é€Ÿã€åŠ‡çƒˆæˆ–ä¸è¦å‰‡åœ°è·³å‹•ã€‚",
  "æ„Ÿè¦ºèº«é«”ç·Šå¼µä¸å®‰ã€‚",
  "æ„Ÿè¦ºå–˜ä¸éæ°£æˆ–å‘¼å¸å›°é›£ã€‚",
  "æ„Ÿè¦ºè‚Œè‚‰ç·Šç¹ƒã€‚",
  "æ„Ÿè¦ºæ‰‹ã€è…³æˆ–èº«é«”å†°å†·ã€‚",
  "æ„Ÿè¦ºèƒƒä¸é©ï¼ˆç¿»æ”ªã€ç³¾çµã€å™å¿ƒã€ç¼ç†±ã€åèƒƒã€è„¹æ°£ç­‰ï¼‰ã€‚",
  "æ„Ÿè¦ºæ‰‹æŒå¿ƒæˆ–èº«é«”å…¶ä»–éƒ¨ä½å‡ºæ±—ã€‚",
  "æ„Ÿè¦ºå£ä¹¾èˆŒèºã€‚",
  "æ“”å¿ƒç„¡æ³•å…¥ç¡ã€‚",
  "é–‹å§‹å›æ†¶æˆ–æ€è€ƒä¸€å¤©æ‰€ç™¼ç”Ÿäº‹æƒ…ã€‚",
  "æ†‚é¬±æˆ–ç„¦æ…®çš„æƒ³æ³•ã€‚",
  "æ“”å¿ƒç¡çœ ä»¥å¤–çš„å•é¡Œã€‚",
  "æ€æƒ³æ¸…æ¥šã€æ´»èºã€‚",
  "ç„¡æ³•åœæ­¢æ€è€ƒã€‚",
  "æ€æƒ³æŒçºŒç›¤æ—‹åœ¨å¿ƒè£¡ã€‚",
  "è¢«ç’°å¢ƒçš„è²éŸ³æˆ–å™ªéŸ³æ‰€å›°æ“¾ã€‚"
];

const psasOptions = [
  "å®Œå…¨æ²’æœ‰æ„Ÿè¦º",
  "ç¨å¾®æ„Ÿè¦ºåˆ°",
  "ä¸­ç­‰å¼·åº¦çš„æ„Ÿè¦º",
  "å¼·çƒˆæ„Ÿè¦º",
  "æ¥µç«¯å¼·çƒˆçš„æ„Ÿè¦º"
];

/* ===============================
   ç”¢ç”Ÿ APS
================================ */
const apsContainer = document.getElementById("aps-container");

apsQuestions.forEach((q, i) => {
  apsContainer.innerHTML += `
    <div class="question">
      ${i+1}. ${q}
      <button type="button" onclick="speak('${q}',1)">ğŸ”Š</button>
      <button type="button" onclick="speak('${q}',0.6)">ğŸ¢</button>
      <div class="option">
        ${apsOptions.map((opt,v)=>`
          <label>
            <input type="radio" name="APS${i+1}" value="${v+1}"
                   onchange="recordAPS(${i+1})"> ${opt}
          </label>`).join("")}
      </div>
    </div>`;
});

function recordAPS(n) {
  const key = "APS" + n;
  if (!apsFirstResponseTime[key]) {
    apsFirstResponseTime[key] = Date.now() - surveyStartTime;
  }
}

/* ===============================
   ç”¢ç”Ÿ PSAS
================================ */
const psasContainer = document.getElementById("psas-container");

psasQuestions.forEach((q, i) => {
  psasContainer.innerHTML += `
    <div class="question">
      ${i+1}. ${q}
      <button type="button" onclick="speak('${q}',1)">ğŸ”Š</button>
      <button type="button" onclick="speak('${q}',0.6)">ğŸ¢</button>
      <div class="option">
        ${psasOptions.map((opt,v)=>`
          <label>
            <input type="radio" name="PSAS${i+1}" value="${v+1}"
                   onchange="recordPSAS(${i+1})"> ${opt}
          </label>`).join("")}
      </div>
    </div>`;
});

function recordPSAS(n) {
  const key = "PSAS" + n;
  if (!psasFirstResponseTime[key]) {
    psasFirstResponseTime[key] = Date.now() - surveyStartTime;
  }
}

/* ===============================
   èªéŸ³æœ—è®€
================================ */
function speak(text, rate) {
  const synth = window.speechSynthesis;
  synth.cancel();

  ttsCount++;
  ttsLog.push({
    item: text,
    rate: rate,
    time: new Date().toISOString()
  });

  setTimeout(() => {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "zh-TW";
    u.rate = rate;
    synth.speak(u);
  }, 120);
}

/* ===============================
   é€å‡º
================================ */
function submitForm() {
  const name = document.getElementById("name").value.trim();
  const age = document.getElementById("age").value;
  const gender = document.querySelector('input[name="gender"]:checked');

  if (!name || !age || !gender) {
    alert("è«‹å®Œæ•´å¡«å¯«åŸºæœ¬è³‡æ–™");
    return;
  }

  for (let i=1;i<=12;i++) {
    if (!document.querySelector(`input[name="APS${i}"]:checked`)) {
      alert(`APS ç¬¬ ${i} é¡Œæœªä½œç­”`);
      return;
    }
  }

  for (let i=1;i<=16;i++) {
    if (!document.querySelector(`input[name="PSAS${i}"]:checked`)) {
      alert(`PSAS ç¬¬ ${i} é¡Œæœªä½œç­”`);
      return;
    }
  }

  const surveyEndTime = Date.now();

  const data = {
    name,
    age,
    gender: gender.value,
    start_time: new Date(surveyStartTime).toISOString(),
    end_time: new Date(surveyEndTime).toISOString(),
    total_time_sec: Math.round((surveyEndTime - surveyStartTime)/1000),
    tts_count: ttsCount,
    tts_detail: JSON.stringify(ttsLog)
  };

  for (let i=1;i<=12;i++) {
    data["APS"+i] = document.querySelector(`input[name="APS${i}"]:checked`).value;
    data["APS"+i+"_time_sec"] =
      Math.round((apsFirstResponseTime["APS"+i]||0)/1000);
  }

  for (let i=1;i<=16;i++) {
    data["PSAS"+i] = document.querySelector(`input[name="PSAS${i}"]:checked`).value;
    data["PSAS"+i+"_time_sec"] =
      Math.round((psasFirstResponseTime["PSAS"+i]||0)/1000);
  }

fetch("ã€æ–°çš„ exec URLã€‘", {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify({ test: "hello" })
})
.then(res => res.text())
.then(txt => alert("GAS å›æ‡‰ï¼š" + txt))
.catch(err => alert("éŒ¯èª¤ï¼š" + err));
}
</script>

</body>
</html>

